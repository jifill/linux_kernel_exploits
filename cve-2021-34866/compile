#!/bin/sh
set -x

gcc -Wall hello__blocking_read.c `pkg-config fuse --cflags --libs` -o hello__blocking_read
res=$?
if [ $res -ne 0 ];
then
    echo "compilation failed..."
    exit 1
fi

gcc -static -o exploit exploit.c -w
res=$?

if [ $res -ne 0 ];
then
    echo "compilation failed..."
    exit 1
fi

mkdir -p temp2
umount temp2

if [ ! -f disk.img ]
then
gunzip disk.img.gz
fi

mount -t ext4 -o loop disk.img temp2
cd temp2
pwd

#put binary in archive
cp ../exploit ./home/jass93/
cp ../hello__blocking_read ./home/jass93/
cd -
umount temp2
